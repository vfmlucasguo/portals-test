"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applicationSchematic = exports.applicationGenerator = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const add_angular_1 = require("./lib/add-angular");
const add_capacitor_1 = require("./lib/add-capacitor");
const add_dependencies_1 = require("./lib/add-dependencies");
const external_schematic_1 = require("./lib/external-schematic");
const files_1 = require("./lib/files");
const normalize_options_1 = require("./lib/normalize-options");
const update_eslint_config_1 = require("./lib/update-eslint-config");
const update_workspace_1 = require("./lib/update-workspace");
function applicationGenerator(host, options) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const normalizedOptions = (0, normalize_options_1.normalizeOptions)(host, options);
        const installTask = (0, add_dependencies_1.addDependencies)(host);
        const angularTask = yield (0, add_angular_1.addAngular)(host, options);
        (0, files_1.addFiles)(host, normalizedOptions);
        (0, files_1.removeFiles)(host, normalizedOptions);
        (0, update_workspace_1.updateWorkspace)(host, normalizedOptions);
        (0, update_eslint_config_1.updateEslintConfig)(host, normalizedOptions);
        (0, external_schematic_1.generateCapacitorProject)(normalizedOptions);
        let capacitorTask = null;
        if (options.capacitor) {
            capacitorTask = yield (0, add_capacitor_1.addCapacitor)(host, normalizedOptions);
        }
        if (!options.skipFormat) {
            yield (0, devkit_1.formatFiles)(host);
        }
        return () => {
            installTask();
            angularTask();
            if (capacitorTask) {
                capacitorTask();
            }
        };
    });
}
exports.applicationGenerator = applicationGenerator;
exports.default = applicationGenerator;
exports.applicationSchematic = (0, devkit_1.convertNxGenerator)(applicationGenerator);
//# sourceMappingURL=generator.js.map